<center>
![](data/ait.png)
</center>

---
title: "AA224 - Advanced Analytics Group Project Assignment 2"
authors: "Gavin Byrne (A00267975), Luke Feeney (A00268130),Brendan Lynch (A00267986)"
date: "30 November 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Introduction{.tabset}
The purpose of this project is to create models for the following three techniques:

1. Decision Trees
2. kNN
3. Regression

We begin with a description of the datasets used, and the cleaning that was done to them to make them more usable for the models we created. Next, for each model we explain how the model was created and the performance of those models.

Finally, we present a conclusion of our analyses and the challenges etc. that we faced.

## Packages Required
dplyr  
tidyr  
knitr  
kableExtra 

```{r warning=FALSE, message = FALSE}
installPackage <- function(name){
  options(repos=c(CRAN="https://ftp.heanet.ie/mirrors/cran.r-project.org/"))
  if(name %in% rownames(installed.packages()) == FALSE) {
    install.packages(name)
  }
}

installPackage("dplyr")
installPackage("tidyr")
installPackage("knitr")
installPackage("kableExtra")
installPackage("psych")


library("dplyr")
library("tidyr")
library("knitr")
library("kableExtra")
library("psych")


```

## 2. Data Exploration

### 2.1 Regression- Concrete Compressive Strength
#### 2.1.1  Summary
The dataset 'Concrete_Data.csv' describes variables that contribute towards different measurements of concrete compressive strength. According to the dataset source -"The concrete compressive strength is a highly non-linear function of age and ingredients." It may be fair to assume then that age will have an affect on the compressive strength along with one or more ingredients. These ingredients include cement, blast furnace slag, fly ash, water, superplasticizer, coarse aggregate, and fine aggregate. Concrete compressive strength is the output variable, while the other variables (such as ingredients and age) are input variables.

```{r,message=FALSE, warning=FALSE, echo=TRUE, results='hide'}
# Regression: Import data for regression question - concrete compressive strength
df_concrete <- read.csv("data/Concrete_Data.csv")
```

The compressive concrete dataset requires some minor changes to the headers to make them easier to read, namely removing the units.

```{r,message=FALSE, warning=FALSE, echo=TRUE, results='hide'}
# Regression: Rename headers (shorten the names)
colnames(df_concrete) <- c("Cement",
                           "Blast Furnace Slag",
                           "Fly Ash",
                           "Water",
                           "Superplasticizer",
                           "Coarse Aggregate",
                           "Fine Aggregate",
                           "Age",
                           "Concrete Comp. Strength")
```

```{r,message=FALSE, warning=FALSE, echo=TRUE, results='show'}
# Regression: Summary of data
summary(df_concrete)
```

#### 2.1.2 Exploring the dependant variable

```{r,message=FALSE, warning=FALSE, echo=FALSE, results='hide'}
df_concrete_mean <- mean(df_concrete$"Concrete Comp. Strength")
df_concrete_median <- median(df_concrete$"Concrete Comp. Strength")
```
Creating a histogram of the dependant variable (compressive strength) and by investigating the mean ``r df_concrete_mean`` and median ``r df_concrete_median``  (which are similar to each other) we can see that the data appears to be normally distributed.

```{r,message=FALSE, warning=FALSE, echo=TRUE, results='show'}
# Investigating the dependant variable
hist(df_concrete$"Concrete Comp. Strength", main='Histogram of Concrete Compressive Strength', xlab='Concrete Compressive Strength')
```

#### 2.1.3 Investigating the relationships between the features

Using the 'psych' library we can create a scatterplot matrix to compare the relationships of all the features using pair.panels.
```{r,message=FALSE, warning=FALSE, echo=TRUE, results='show'}
# Creating a scatterplot matrix to investigate the relationships between the features
pairs.panels(df_concrete[c("Cement",
                           "Blast Furnace Slag",
                           "Fly Ash",
                           "Water",
                           "Superplasticizer",
                           "Coarse Aggregate",
                           "Fine Aggregate",
                           "Age",
                           "Concrete Comp. Strength")])
```

The resulting chart above shows that for cement has a stronger relationship than the other features to the concrete compressive strength. We can see this by the increasing sloping line and the higher correlation value between cement and comp. strength. Superplasticizer and age appears to also have a strong relationship with compressive strength. Age is also interesting, in that it appear to increase quite quickly and then level off in terms of its relationship with concrete compressive strength.

### 2.2 Decision Trees

### 2.2 kNN


## 3. Decision Trees{.tabset}
textexttext

### 3.1 Data Preparation

```{r warning=FALSE}

```

### 3.2 Predictive Model

```{r warning=FALSE}

```

### 3.3 Evaluation of model Performance

```{r warning=FALSE}

```


## 4. kNN{.tabset}
textexttext

### 4.1 Data Preparation

```{r warning=FALSE}

```

### 4.2 Predictive Model

```{r warning=FALSE}

```

### 4.2 Evaluation of model Performance

```{r warning=FALSE}

```

## 5. Regression
As mentioned previously, the concrete compressive strength in the dataset is the dependant variable, and we are trying to use the features to model this output variable. We will creat a model using all the features(as it is hypotheized that they are all important) and then use techniques such as stepwise selection to see what can be changed in the model to make it more effective. Finally, an anlyisis will be done on the summary of the final model to asses performance.

### 5.1 Data Preparation

As the data was already clean, no further work was required (other than the renaming of variables previously done).

### 5.2 Predictive Model

The intial pass at the model used all the features.

```{r,message=FALSE, warning=FALSE, echo=TRUE, results='hide'}
# create a model on the concrete data using all features
concrete_model <- lm(df_concrete$"Concrete Comp. Strength" ~ Cement + `Blast Furnace Slag` + 
                        `Fly Ash` + Water + Superplasticizer + `Coarse Aggregate` + 
                        `Fine Aggregate` + Age, data = df_concrete)
```

In order to confirm if a subset of the features could be used to develop the model, we used stepwise selection to confirm if any features could be left out (or which features would perform the best)
```{r,message=FALSE, warning=FALSE, echo=TRUE, results='show'}
# Use stepwise regression to check if any variables can be possibly removed from the model
step(concrete_model)
```

From the above, it appears that all the features contribute somewhat significantly - and I believe this to be due to the fact that all these constitute parts to indeed improve compressive strength in concrete. However, in what quantities would be a different question.

A second model was created with an interaction feature added in (cement and age). These were combined as it appeared from the summary results of the model and the investigation into the relationship between the features that these were influential on the strength of the concrete.

```{r,message=FALSE, warning=FALSE, echo=TRUE, results='hide'}
# Adding interaction term to generate new model (testing for interaction between cement and age)
concrete_model_CA <- lm(df_concrete$"Concrete Comp. Strength" ~ Cement + `Blast Furnace Slag` + 
                       `Fly Ash` + Water + Superplasticizer + `Coarse Aggregate` + 
                       `Fine Aggregate` + Age + Cement*Age, data = df_concrete)
```

### 5.3 Evaluation of model Performance

The summary command shows us the performance of our first model (all the features used).
```{r,message=FALSE, warning=FALSE, echo=TRUE, results='show'}
# Evaluate model performance using all the features
summary(concrete_model)
```

From the residuals we can see that the errors are quite small, with the predictive values being 6 MPa over/under the true value.
We have several features that contribute significantly to the model, in particular we can see cement, blast furnace slag and age being particular powerful and highly statistically significant.

Our adjusted R squared value, ``rsummary(concrete_model)$r.squared``, explains the performance of the model quite well, and as its close to 1.0 it signifies that the model explains the data well.

We added an interaction feature in our second model, and the results were as follows:
```{r,message=FALSE, warning=FALSE, echo=TRUE, results='show'}
# Evaluate model performance with new feature added
summary(concrete_model_CA)
```

The model did appear to improve slightly with the new adjusted R squared value of ``rsummary(concrete_model_CA)$r.squared``, but it was only a minor change.

Reviewing the plots of our final model, it appears that the data is not affected by outliers and that the data comes from a normal distribution (as seen in the QQ plot).
```{r,message=FALSE, warning=FALSE, echo=TRUE, results='show'}
# Plots of model generated
par(mfrow=c(2,2))
plot(concrete_model_CA)
```

## 6. Discussion/Reflection

The work was split up amongst the team where individually we would work on creating the models and then once complete, review the work done and merge the script changes in github. Finally we would work together to create the final markdown file.

For the regression problem, the dataset was interesting in terms of some of the background research into concrete compressive strength. As the data required little to no cleaning, not much can be said about the state of the data other than that it was very easy to work with.
Creating the model brought up some interesting results, namely that while cement would clearly be a large factor in creating concrete, that age plays a significant part in improving compressive strength. Adding in age and cement as an interaction feature, did not have as strong as an effect as it seemingly would have. It did improve the adjusted R squared value, but we were expecting that it would have had a better effect on the performance of the model.